# Fix: Product Brief Versioning Confusion

## Bug Details

**Branch:** `fix/product-brief-versioning-confusion`
**Created:** 2026-01-07
**Severity:** Minor annoyance

### Steps to Reproduce

1. Work on a product and stabilize it (product brief created outside system)
2. Later, run `/pro:product.brief` to add a new feature idea
3. Command produces `.plan/product/brief.md`

### Expected Behavior

- The new brief should be clearly distinguished from any prior work
- It should be obvious this is ONE brief among potentially many
- The system should not imply this single file represents the entire product

### Actual Behavior

- Command creates `.plan/product/brief.md` as if it's THE product brief
- Misleading for mature products that never had a formal brief created via this command
- Red herring: makes it seem like the entire product is captured in this one file

### Environment

- macOS, ccplugins v1.x
- `/pro:product.brief` command

---

## Related ADRs

**ADR-031** (Product Validation Pipeline Architecture):
- Already specifies "Timestamped files" for versioning
- Current implementation doesn't follow this decision
- This fix aligns implementation with the existing ADR

---

## Root Cause

The command definition at `pro/commands/product.brief.md` (lines 21-22, 152):
```markdown
- A structured product brief at `.plan/product/brief.md`
...
Write the brief to `.plan/product/brief.md`
```

The command writes to a single, unversioned file. This contradicts:
1. ADR-031's decision for "timestamped files"
2. The natural expectation that multiple briefs can exist

---

## Fix Implementation

### Approach: Index + Timestamped Files

Transform `.plan/product/brief.md` into an index that links to individual briefs stored with timestamps.

### New Structure

```
.plan/product/
├── brief.md                           # Index file (links to all briefs)
├── briefs/
│   ├── 2026-01-07-user-analytics.md   # Timestamped brief files
│   ├── 2026-01-05-payment-flow.md
│   └── ...
└── validate/                          # Existing validation reports
```

### Changes Required

1. **Update `pro/commands/product.brief.md`**
   - Create `briefs/` subdirectory
   - Generate timestamped filename: `YYYY-MM-DD-{slugified-title}.md`
   - Create/update `brief.md` as index linking to all briefs
   - Preserve existing behavior for first brief

2. **Index File Format**
   ```markdown
   # Product Briefs

   | Date | Title | Status |
   |------|-------|--------|
   | 2026-01-07 | [User Analytics](briefs/2026-01-07-user-analytics.md) | New |
   | 2026-01-05 | [Payment Flow](briefs/2026-01-05-payment-flow.md) | Validated |

   *Generated by /pro:product.brief*
   ```

3. **Brief File Naming**
   - Format: `YYYY-MM-DD-{slugified-working-title}.md`
   - Example: `2026-01-07-user-analytics-dashboard.md`

### Migration Path

- Existing `brief.md` files are preserved (command detects and converts)
- No breaking changes for users with existing briefs

---

## Definition of Done

- [x] Command creates briefs in `briefs/` subdirectory
- [x] Brief filenames include date and slugified title
- [x] Index file created/updated at `brief.md`
- [x] Existing single-file briefs migrated gracefully
- [x] `/pro:product.validate` updated to work with new structure
- [x] ADR created documenting this change
- [x] Extracted product-brief skill for reusability

---

## Related ADRs (Created)

- [ADR-040: Product Brief Versioned Storage](../../../doc/decisions/040-product-brief-versioned-storage.md)
